How to deploy on server

In this document you can find the instructions how to deploy the EuropeanaLabs on a server environment. For development
setup please consult README_FIRST.txt.


Requirements:
    - Java 1.6 or higher
    - linux 2.5 or higher (Debian recommended)
    - postgresql database 8.3 or higher
    - ImageMagick 6.4 or higher
    - ESP Ghostscript 8.15.2 or higher
    - Tomcat 6 or higher (for portal)
    - SMTP server to send emails
    - Jetty 6 or higher (for apache Solr)


Build Components
---------------------------

//Build the components from the root where this file is found.

//build database component and install in your local maven2 repository
# cd database
# mvn clean install -Dmaven.test.skip=true

//builds api component. The war file can be found in the target dir.
# cd ../api
# mvn clean package -Dmaven.test.skip=true

//builds portal-lite component. The war file can be found in the target dir.
# cd ../portal-lite
# mvn clean package -Dmaven.test.skip=true

//builds dashboard component. The war file can be found in the target dir.
# cd ../dashboard
# mvn clean package -Dmaven.test.skip=true



Deploy components in Tomcat
-----------------------------

- Copy the cache.war, resolve.war, portal.war, dashboard.war to the tomcat deploy directory (i.e. webapps dir in the
Tomcat root) on the server.
- Copy the europeana.properties.template file from ./portal/src/main/resources/europeana.properties to the server and change
relevant properties.
- Add the europeana properties file to the tomcat startup parameters, e.g. -Deuropeana.config=/usr/local/tomcat/conf/europeana.properties
// NB Also make sure that tomcat has enough heap space. We recommend -Xmx2048m .

Deploy Solr

//Make sure that Jetty is installed. (We prefer to use Jetty for solr deployment. However, there is no reason why it cannot
be deployed on Tomcat with the other components. Just remember to increase the heap space if you do so. )
- Copy ./database/src/test/solr/solr.war to the jetty deploy directory (i.e. webapps dir in the
jetty root) on the server and rename to solr.war.
- Copy the Solr Home from ./portal/src/test/solr/solr/ to the server (!recursively copy all files). Any location would do.
Remember that the index is stored inside the Solr Home so make sure that there is enough disk space available where you place solr home.
- add the Solr Home to the Jetty/Tomcta startup parameters, e.g. -Dsolr.solr.home=/path/to/solr/home"


Initiate the database

When you start Tomcat the database is created automatically. However, some information needs to be provided in order for
the portal and dashboard to work properly.

If you already have a development copy of the database running please make a dump and import it on the Server.

dev machine # pg_dump -E utf-8 -U your_db_name -f your_dump_file your_db_name
server      # psql -U your_db_name europeana < your_dump_file

If you do not have a development copy of the database you can use the following command to init the database.
// todo: add command to init db.
#

To import and index the sample data please run the following command:
//
#